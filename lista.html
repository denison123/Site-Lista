<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supermercado Inteligente</title>
    <link rel="stylesheet" href="style.css">
    <style>

    </style>
</head>

<body>

    <div class="container">
        <h2>ðŸ›’ Lista de Compras Inteligente ðŸ›’</h2>
        <div class="controles">
            <input type="text" id="pesquisa" placeholder="ðŸ” Pesquisar produto..." onkeyup="filtrar()">
            <button class="btn-add" onclick="adicionarLinha()">+ Novo Item</button>
        </div>

        <table id="tabelaCompras">
            <thead>
                <tr>
                    <th style="width: 40px;">âœ”</th>
                    <th>Item</th>
                    <th style="width: 80px;">Qtd</th>
                    <th style="width: 110px;">PreÃ§o (R$)</th>
                    <th style="width: 100px;">Total</th>
                </tr>
            </thead>
            <tbody id="corpoTabela"></tbody>
        </table>

        <div class="total-box">
            Total Geral: R$ <span id="valorTotalGeral">0,00</span>
        </div>

        <div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
            <button class="btn-limpar" onclick="limparTabela()">ðŸ§¹ Limpar Tudo</button>
            <small style="color: #888;">* Salva automaticamente no navegador.</small>
        </div>
    </div>

    <script>
        window.onload = carregarDados;

        function adicionarLinha(nome = "", qtd = 1, valor = 0, pego = false) {
            const tabela = document.getElementById("corpoTabela");
            const novaLinha = document.createElement("tr");
            if (pego) novaLinha.classList.add("item-pego");

            // Usei "text" para o preÃ§o para aceitar a vÃ­rgula BR mais facilmente
            novaLinha.innerHTML = `
            <td style="text-align: center;"><input type="checkbox" ${pego ? 'checked' : ''} onclick="marcarItem(this)"></td>
            <td><input type="text" placeholder="Nome..." value="${nome}" oninput="salvarDados()"></td>
            <td><input type="number" value="${qtd}" min="1" oninput="calcular()"></td>
            <td><input type="text" value="${valor.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}" oninput="calcular()" placeholder="0,00"></td>
            <td class="totalItem" style="font-weight: bold;">0,00</td>
        `;

            tabela.insertBefore(novaLinha, tabela.firstChild);
            calcular();
        }

        function marcarItem(checkbox) {
            const linha = checkbox.parentElement.parentElement;
            checkbox.checked ? linha.classList.add("item-pego") : linha.classList.remove("item-pego");
            salvarDados();
        }

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function converterParaNumero(valorString) {
            // Remove pontos de milhar e troca vÃ­rgula por ponto para o JS calcular
            let limpo = valorString.replace(/\./g, '').replace(',', '.');
            return parseFloat(limpo) || 0;
        }

        function calcular() {
            let totalGeral = 0;
            const linhas = document.querySelectorAll("#corpoTabela tr");

            linhas.forEach(linha => {
                const inputs = linha.querySelectorAll("input");
                const qtd = parseFloat(inputs[2].value) || 0;
                const valorUnitario = converterParaNumero(inputs[3].value);

                const totalItem = qtd * valorUnitario;

                linha.querySelector(".totalItem").innerText = formatarMoeda(totalItem);
                totalGeral += totalItem;
            });

            document.getElementById("valorTotalGeral").innerText = formatarMoeda(totalGeral);
            salvarDados();
        }

        function filtrar() {
            const busca = document.getElementById("pesquisa").value.toLowerCase();
            const linhas = document.querySelectorAll("#corpoTabela tr");
            linhas.forEach(linha => {
                const nomeItem = linha.querySelector("input[type='text']").value.toLowerCase();
                linha.style.display = nomeItem.includes(busca) ? "" : "none";
            });
        }

        function salvarDados() {
            const dados = [];
            const linhas = document.querySelectorAll("#corpoTabela tr");
            linhas.forEach(linha => {
                const inputs = linha.querySelectorAll("input");
                dados.push({
                    pego: inputs[0].checked,
                    nome: inputs[1].value,
                    qtd: inputs[2].value,
                    valor: converterParaNumero(inputs[3].value)
                });
            });
            localStorage.setItem("listaCompras", JSON.stringify(dados.reverse()));
        }

        function carregarDados() {
            const salvo = localStorage.getItem("listaCompras");
            if (salvo) {
                const dados = JSON.parse(salvo);
                document.getElementById("corpoTabela").innerHTML = "";
                dados.forEach(item => {
                    adicionarLinha(item.nome, item.qtd, item.valor, item.pego);
                });
            } else {
                adicionarLinha();
            }
        }

        function limparTabela() {
            if (confirm("Apagar toda a lista?")) {
                localStorage.removeItem("listaCompras");
                document.getElementById("corpoTabela").innerHTML = "";
                document.getElementById("valorTotalGeral").innerText = "0,00";
                adicionarLinha();
            }
        }
    </script>
</body>

</html>